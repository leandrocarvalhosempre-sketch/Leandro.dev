<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quiz Programa√ß√£o PRO (900 perguntas)</title>
  <style>
    :root{--bg:#0b1220;--card:#121b2f;--muted:#9fb0d0;--text:#e9f0ff;--good:#2dd4bf;--bad:#fb7185;--warn:#fbbf24;--btn:#1d2b4d;}
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
    body{margin:0;background:radial-gradient(1000px 600px at 20% 10%, #1b2a55 0%, var(--bg) 60%);color:var(--text);}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .top{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px}
    .title{font-size:18px;font-weight:900}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);padding:8px 10px;border-radius:999px;color:var(--muted);font-size:13px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.12);border-radius:18px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .grid{display:grid;gap:12px}
    @media(min-width:860px){ .grid{grid-template-columns: 1.15fr .85fr;} }
    .qmeta{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .badge{font-size:12px;padding:6px 10px;border-radius:999px;background:rgba(96,165,250,.14);
      border:1px solid rgba(96,165,250,.35);color:#cfe4ff}
    .badge.diff{background:rgba(251,191,36,.14);border-color:rgba(251,191,36,.35);color:#ffe7a3}
    .progress{height:10px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden;border:1px solid rgba(255,255,255,.10);margin:10px 0 14px}
    .bar{height:100%;width:0%;background:linear-gradient(90deg, var(--good), #60a5fa);transition:width .35s}
    .question{font-size:20px;line-height:1.25;margin:10px 0 10px;font-weight:950}
    .desc{color:var(--muted);margin:0 0 12px;font-size:14px;line-height:1.3}
    .answers{display:grid;gap:10px}
    button.answer{width:100%;text-align:left;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);color:var(--text);cursor:pointer;font-size:15px;transition:.15s}
    button.answer:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.22);background:rgba(255,255,255,.06)}
    button.answer:disabled{opacity:.75;cursor:not-allowed;transform:none}
    .feedback{margin-top:12px;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04)}
    .fb-top{display:flex;gap:10px;align-items:center;margin-bottom:6px}
    .dot{width:10px;height:10px;border-radius:999px;background:var(--good)}
    .fb-title{font-weight:950}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:var(--btn);color:var(--text);cursor:pointer;font-weight:900}
    .btn.secondary{background:transparent}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    select{width:100%;padding:10px 10px;border-radius:12px;border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.18);color:var(--text);outline:none}
    .panel-title{font-weight:950;margin:0 0 10px;font-size:14px;color:#d8e7ff}
    .mini{font-size:12px;color:var(--muted);margin:8px 0 0}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:7px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--muted);font-size:12px}
    .chip strong{color:var(--text)}
    .rank{display:grid;gap:8px;margin-top:8px}
    .rank-item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px;border-radius:14px;
      border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);font-size:13px}
    .rank-left{display:flex;gap:10px;align-items:center}
    .pos{width:26px;height:26px;border-radius:10px;display:flex;align-items:center;justify-content:center;
      border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.18);color:#dbeafe;font-weight:950}
    .end{text-align:center;padding:14px 10px}
    .big{font-size:26px;font-weight:980;margin:6px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="title">üéÆ Quiz Programa√ß√£o PRO ‚Äî 900 perguntas (150 por categoria)</div>
      <div class="row">
        <div class="pill">‚úÖ Pontos: <span id="score">0</span></div>
        <div class="pill">üî• Streak: <span id="streak">0</span></div>
        <div class="pill">‚≠ê Melhor streak: <span id="best">0</span></div>
      </div>
    </div>

    <div class="grid">
      <div class="card" id="game">
        <div class="qmeta">
          <div class="row" style="gap:8px">
            <div class="badge" id="badgeLang">üìö Categoria</div>
            <div class="badge diff" id="badgeDiff">üéöÔ∏è N√≠vel</div>
          </div>
          <div class="pill">Pergunta <span id="idx">1</span>/<span id="total">0</span></div>
        </div>

        <div class="progress"><div class="bar" id="bar"></div></div>

        <div class="question" id="question">Carregando...</div>
        <p class="desc" id="desc"></p>

        <div class="answers" id="answers"></div>

        <div class="feedback" id="feedback" style="display:none;">
          <div class="fb-top">
            <div class="dot" id="dot"></div>
            <div class="fb-title" id="fbTitle"></div>
          </div>
          <p class="desc" id="explain" style="margin:0"></p>
        </div>

        <div class="actions">
          <button class="btn" id="next" disabled>Pr√≥xima ‚ûú</button>
          <button class="btn secondary" id="restart">Reiniciar</button>
        </div>

        <div class="actions" style="margin-top:10px">
          <button class="btn secondary" id="help5050">üÉè 50/50 (<span id="h5050">1</span>)</button>
          <button class="btn secondary" id="helpHint">üí° Dica (<span id="hHint">2</span>)</button>
          <button class="btn secondary" id="helpSkip">‚è≠Ô∏è Pular sem perder streak (<span id="hSkip">1</span>)</button>
        </div>

        <p class="mini">
          Pontos: acerto <b>+10</b> ‚Ä¢ erro <b>-2</b> (nunca abaixo de 0) ‚Ä¢ erro zera streak.
          Alternativas s√£o embaralhadas a cada pergunta.
        </p>
      </div>

      <div class="card">
        <div class="panel-title">‚öôÔ∏è Configura√ß√µes</div>

        <label class="mini" for="mode">Modo</label>
        <select id="mode">
          <option value="normal">Normal (mistura categorias)</option>
          <option value="train">Treino (uma categoria)</option>
        </select>

        <div style="height:10px"></div>

        <label class="mini" for="difficulty">N√≠vel</label>
        <select id="difficulty">
          <option value="F√°cil">F√°cil</option>
          <option value="M√©dio">M√©dio</option>
          <option value="Dif√≠cil">Dif√≠cil</option>
        </select>

        <div style="height:10px"></div>

        <label class="mini" for="category">Categoria (para Treino)</label>
        <select id="category">
          <option value="Java">Java</option>
          <option value="JavaScript">JavaScript</option>
          <option value="Python">Python</option>
          <option value="HTML">HTML</option>
          <option value="CSS">CSS</option>
          <option value="L√≥gica">L√≥gica</option>
        </select>

        <div style="height:12px"></div>

        <div class="panel-title">üèÜ Ranking local (Top 10)</div>
        <div class="mini">Salvo no seu celular via <b>localStorage</b>.</div>
        <div class="rank" id="rank"></div>

        <div style="height:12px"></div>

        <div class="panel-title">üìå Status</div>
        <div class="chips">
          <div class="chip">Modo: <strong id="sMode">Normal</strong></div>
          <div class="chip">N√≠vel: <strong id="sDiff">F√°cil</strong></div>
          <div class="chip">Categoria: <strong id="sCat">‚Äî</strong></div>
        </div>

        <div class="actions" style="margin-top:12px">
          <button class="btn" id="apply">Aplicar configura√ß√µes</button>
          <button class="btn secondary" id="clearRank">Limpar ranking</button>
        </div>

        <p class="mini">
          Dica: se voc√™ abrir este arquivo direto (double-click), alguns navegadores podem bloquear o carregamento do JSON.
          Use Live Server no VS Code (porta 5500) para funcionar 100%.
        </p>
      </div>
    </div>

    <div class="card" id="end" style="display:none;margin-top:12px;">
      <div class="end">
        <div class="big">üèÅ Fim do jogo!</div>
        <p class="mini">Seu resultado:</p>
        <div class="big"><span id="finalScore">0</span> pontos</div>
        <p class="mini">Melhor streak: <span id="finalBest">0</span></p>
        <div class="actions" style="justify-content:center">
          <button class="btn" id="playAgain">Jogar de novo</button>
        </div>
      </div>
    </div>

  </div>
  
init();
<script>
  function buildQuestionSet() {
  const { mode, diff, cat } = currentSettings();

  let filtered = ALL.filter(q => q.diff === diff);

  if (mode === "train") {
    filtered = filtered.filter(q => q.lang === cat);
  }

  // se por algum motivo n√£o houver perguntas filtradas, cai no ALL
  return filtered.length > 0 ? filtered : ALL;
  }
let ALL = [];
let __set = [];
let order = [];
let idx = 0;

let score = 0;
let streak = 0;
let best = Number(localStorage.getItem("best_streak") || 0);

let help5050 = 1;
let helpHint = 2;
let helpSkip = 1;

let used5050 = false;
let usedHint = false;

let currentCorrectIndex = -1;
let currentAnswers = [];
let currentExplain = "";

const LS_RANK = "quiz_rank_top10_900";

const $ = (id)=>document.getElementById(id);
const elScore = $("score"), elStreak=$("streak"), elBest=$("best");
const elIdx=$("idx"), elTotal=$("total"), elBar=$("bar");
const elBadgeLang=$("badgeLang"), elBadgeDiff=$("badgeDiff");
const elQ=$("question"), elDesc=$("desc"), elAnswers=$("answers");
const elFeedback=$("feedback"), elDot=$("dot"), elFbTitle=$("fbTitle"), elExplain=$("explain");
const btnNext=$("next"), btnRestart=$("restart");
const btn5050=$("help5050"), btnHint=$("helpHint"), btnSkip=$("helpSkip");
const elH5050=$("h5050"), elHHint=$("hHint"), elHSkip=$("hSkip");
const modeSel=$("mode"), diffSel=$("difficulty"), catSel=$("category");
const btnApply=$("apply"), btnClearRank=$("clearRank");
const sMode=$("sMode"), sDiff=$("sDiff"), sCat=$("sCat");
const rankBox=$("rank");
const game=$("game"), end=$("end");
const finalScore=$("finalScore"), finalBest=$("finalBest"), playAgain=$("playAgain");

function shuffle(arr){
  const a = [...arr];
  for(let j=a.length-1;j>0;j--){
    const k=Math.floor(Math.random()*(j+1));
    [a[j],a[k]]=[a[k],a[j]];
  }
  return a;
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  })[m]);
}

function makeKey(q){
  return `${(q.lang||"").trim()}|${(q.diff||"").trim()}|${(q.q||"").trim().toLowerCase()}`;
}

function dedupeQuestions(list){
  const seen = new Set();
  const out = [];
  for(const q of list){
    const key = makeKey(q);
    if(seen.has(key)) continue;
    seen.add(key);
    out.push(q);
  }
  console.log("Perguntas carregadas:", list.length, "‚Üí sem duplicadas:", out.length);
  return out;
}

// Embaralha respostas SEM alterar a pergunta original
function shuffledAnswers(q){
  const answers = q.a.map((text, i)=>({ text, isCorrect: i === q.c }));
  for(let i=answers.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [answers[i],answers[j]]=[answers[j],answers[i]];
  }
  return {
    a: answers.map(x=>x.text),
    c: answers.findIndex(x=>x.isCorrect)
  };
}

function loadRank(){
  try{
    const raw = localStorage.getItem(LS_RANK);
    const p = raw?JSON.parse(raw):[];
    return Array.isArray(p)?p:[];
  } catch {
    return [];
  }
}
function saveRank(list){ localStorage.setItem(LS_RANK, JSON.stringify(list)); }

function renderRank(){
  const list = loadRank();
  rankBox.innerHTML = "";
  if(list.length===0){
    const div=document.createElement("div");
    div.className="rank-item";
    div.innerHTML="<div class='rank-left'><div class='pos'>‚Äî</div><div>Sem ranking ainda</div></div><div>0</div>";
    rankBox.appendChild(div);
    return;
  }
  list.forEach((r,i)=>{
    const div=document.createElement("div");
    div.className="rank-item";
    div.innerHTML=`
      <div class="rank-left">
        <div class="pos">${i+1}</div>
        <div>
          <div style="font-weight:950">${escapeHtml(r.name)}</div>
          <div class="mini" style="margin:2px 0 0">Modo: ${escapeHtml(r.mode)} ‚Ä¢ ${escapeHtml(r.meta)}</div>
        </div>
      </div>
      <div style="font-weight:980">${r.score}</div>
    `;
    rankBox.appendChild(div);
  });
}

function updateTopUI(){
  elScore.textContent=score;
  elStreak.textContent=streak;
  elBest.textContent=best;
  elH5050.textContent=help5050;
  elHHint.textContent=helpHint;
  elHSkip.textContent=helpSkip;

  btn5050.disabled=help5050<=0;
  btnHint.disabled=helpHint<=0;
  btnSkip.disabled=helpSkip<=0;
}

function currentSettings(){ return {mode:modeSel.value, diff:diffSel.value, cat:catSel.value}; }

function updateStatusChips(){
  const {mode,diff,cat} = currentSettings();
  sMode.textContent = mode==="train" ? "Treino" : "Normal";
  sDiff.textContent = diff;
  sCat.textContent = mode==="train" ? cat : "‚Äî";
}

function buildQuestionSet(){
  const {mode,diff,cat} = currentSettings();
  let filtered = ALL.filter(q=>q.diff===diff);
  if(mode==="train") filtered = filtered.filter(q=>q.lang===cat);
  return filtered.length ? filtered : ALL;
}

function resetHelps(){
  help5050=1;
  helpHint=2;
  helpSkip=1;
}

function showFeedback(ok,title,explain){
  elFeedback.style.display="block";
  elFbTitle.textContent=title;
  elExplain.textContent=explain;
  elDot.style.background = ok ? "var(--good)" : "var(--bad)";
}

function newGame(){
  __set = buildQuestionSet();

  // Ordem sem repeti√ß√£o (√≠ndices √∫nicos)
  order = shuffle([...Array(__set.length).keys()]);

  idx=0;
  score=0;
  streak=0;
  best = Number(localStorage.getItem("best_streak") || 0);

  resetHelps();
  used5050=false;
  usedHint=false;

  game.style.display="block";
  end.style.display="none";
  elTotal.textContent=__set.length;

  updateStatusChips();
  updateTopUI();
  render();
}

function render(){
  btnNext.disabled=true;
  elFeedback.style.display="none";
  elAnswers.innerHTML="";
  used5050=false;
  usedHint=false;

  if(idx >= order.length){
    finishGame();
    return;
  }

  const baseQ = __set[order[idx]];
  const mixed = shuffledAnswers(baseQ);

  currentCorrectIndex = mixed.c;
  currentAnswers = mixed.a;
  currentExplain = baseQ.e || "";

  elIdx.textContent = (idx+1);
  elBar.style.width = (idx/order.length*100)+"%";
  elBadgeLang.textContent = "üìö " + baseQ.lang;
  elBadgeDiff.textContent = "üéöÔ∏è " + baseQ.diff;
  elQ.textContent = baseQ.q;
  elDesc.textContent = baseQ.d || "";

  mixed.a.forEach((txt,iChoice)=>{
    const b=document.createElement("button");
    b.className="answer";
    b.dataset.choice=String(iChoice);
    b.textContent=String.fromCharCode(65+iChoice)+". "+txt;
    b.onclick=()=>pick(iChoice);
    elAnswers.appendChild(b);
  });
}

function pick(choice){
  [...document.querySelectorAll("button.answer")].forEach(b=>b.disabled=true);

  const correct = (choice === currentCorrectIndex);

  if(correct){
    score += 10;
    streak += 1;
    if(streak>best){
      best=streak;
      localStorage.setItem("best_streak", String(best));
    }
    showFeedback(true,"Acertou! ‚úÖ", currentExplain || "Boa!");
  } else {
    score = Math.max(0, score-2);
    streak = 0;
    const c = currentCorrectIndex;
    showFeedback(false,"Quase! ‚ùå", `Certa: ${String.fromCharCode(65+c)}. ${currentAnswers[c]} ‚Äî ${currentExplain}`);
  }

  updateTopUI();
  btnNext.disabled=false;
  elBar.style.width = ((idx+1)/order.length*100)+"%";
}

function next(){
  idx += 1;
  render();
}

function disableWrongTwo(){
  const wrong=[];
  for(let k=0;k<currentAnswers.length;k++) if(k!==currentCorrectIndex) wrong.push(k);
  const toHide = shuffle(wrong).slice(0,2);

  [...document.querySelectorAll("button.answer")].forEach(b=>{
    const ch=Number(b.dataset.choice);
    if(toHide.includes(ch)) b.style.display="none";
  });
}

function use5050(){
  if(help5050<=0 || used5050) return;
  help5050-=1;
  used5050=true;
  disableWrongTwo();
  updateTopUI();
  showFeedback(true,"üÉè 50/50 usado!","Removi 2 alternativas erradas üòâ");
}

function useHint(){
  if(helpHint<=0 || usedHint) return;
  helpHint-=1;
  usedHint=true;
  showFeedback(true,"üí° Dica!","Elimine as op√ß√µes absurdas e foque no conceito principal.");
  updateTopUI();
}

function useSkipNoStreakLoss(){
  if(helpSkip<=0) return;
  helpSkip-=1;
  updateTopUI();
  showFeedback(true,"‚è≠Ô∏è Pulou sem perder streak!","Voc√™ pulou esta pergunta sem resetar sua sequ√™ncia.");
  btnNext.disabled=false;
  [...document.querySelectorAll("button.answer")].forEach(b=>b.disabled=true);
}

function finishGame(){
  game.style.display="none";
  end.style.display="block";

  finalScore.textContent=score;
  finalBest.textContent=best;

  const {mode,diff,cat} = currentSettings();
  const name = prompt("Seu nome para o ranking (Top 10):", "Leandro") || "Jogador";
  const meta = mode==="train" ? `N√≠vel ${diff} ‚Ä¢ ${cat}` : `N√≠vel ${diff}`;

  const entry = {
    name: name.slice(0,20),
    score,
    mode: (mode==="train"?"Treino":"Normal"),
    meta,
    ts: Date.now()
  };

  const list=loadRank();
  list.push(entry);
  list.sort((a,b)=> b.score-a.score || b.ts-a.ts);
  saveRank(list.slice(0,10));
  renderRank();
}

// Eventos
btnNext.addEventListener("click", next);
btnRestart.addEventListener("click", newGame);
btnApply.addEventListener("click", newGame);
btnClearRank.addEventListener("click", ()=>{ localStorage.removeItem(LS_RANK); renderRank(); });
btn5050.addEventListener("click", use5050);
btnHint.addEventListener("click", useHint);
btnSkip.addEventListener("click", useSkipNoStreakLoss);
playAgain.addEventListener("click", newGame);

updateTopUI();
renderRank();
updateStatusChips();

// Carregar JSON e iniciar
(async function init(){
  try{
    const res = await fetch("./questions.json");
    if(!res.ok) throw new Error("N√£o consegui carregar questions.json");
    const data = await res.json();
    ALL = dedupeQuestions(Array.isArray(data)?data:[]);
    if(ALL.length===0) throw new Error("questions.json vazio ou inv√°lido");
    newGame();
  } catch (e){
    console.error(e);
    elQ.textContent = "Erro ao carregar perguntas.";
    elDesc.textContent = "Abra com Live Server (n√£o por duplo clique) e confira se questions.json est√° na mesma pasta.";
  }
})();
</script>
